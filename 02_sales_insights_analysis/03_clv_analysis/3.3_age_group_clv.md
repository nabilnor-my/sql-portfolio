# Task 3.3: Age-Based Customer Segmentation

## ðŸ“Œ Goal
To evaluate **Customer Lifetime Value (CLV)** across different **age groups** using TheLook E-commerce dataset.  
This analysis identifies which age cohorts generate the most value through differences in order frequency, revenue, and lifespan.

## ðŸ“‚ Dataset
**Source:** `bigquery-public-data.thelook_ecommerce`  
**Tables used:**  
- `order_items` â†’ product-level transaction data  
- `orders` â†’ order-level metadata  
- `users` â†’ customer demographics  

**Filter criteria:**  
- Country = `United States`  
- Order status = `Complete`  
- Period covered: full dataset range  

## ðŸ’» Queries Overview

### ðŸ”¹ Data Preparation
Joined the three tables (`order_items`, `orders`, `users`) to form `step1_joined_data`.  
- Ensured only completed U.S. orders.  
- Brought in `age` for segmentation.

### ðŸ”¹ User-Level Metrics
Aggregated data per user (`step2_user_level`) to calculate:  
- `user_order_count` (distinct orders per customer)  
- `user_revenue` (total revenue per customer)  
- `first_order` and `last_order` timestamps (for lifespan)

### ðŸ”¹ CLV Components
Derived intermediate components:
- **Lifespan** = `TIMESTAMP_DIFF(last_order, first_order, DAY)/30`
- **AOV** = `user_revenue / user_order_count`
- **Purchase Frequency** = `SAFE_DIVIDE(user_order_count, NULLIF(user_customer_lifespan, 0))`
- **CLV** = `AOV * Frequency * Lifespan`

Used `NULLIF()` to guard against division by zero, and `SAFE_DIVIDE` to ensure query stability.

### ðŸ”¹ Aggregation by Segment
Rolled individual CLVs up by **age group**:

| Age Group | Definition |
|------------|-------------|
| Under 18 | age < 18 |
| 18â€“24 | age between 18 and 24 |
| 25â€“34 | age between 25 and 34 |
| 35â€“44 | age between 35 and 44 |
| 45â€“54 | age between 45 and 54 |
| 55â€“64 | age between 55 and 64 |
| Above 65 | age > 64 |

A **sanity check** query compared `SUM(age_group_revenue)` from the aggregated table against the base datasetâ€™s total `SUM(sale_price)` to ensure integrity.

---

## ðŸ›  Skills Demonstrated
- SQL Data Joining & Aggregation  
- Use of `SAFE_DIVIDE`, `NULLIF`, and `GREATEST` for robust numeric handling  
- Segmentation logic using `CASE WHEN`  
- CLV computation & business interpretation  
- Sanity check validation for data consistency  

---

## ðŸ“Š Results

| Age Group | Total Customers |   AOV | Avg Revenue/Customer | Avg Orders/Customer | Segment Revenue | Total CLV | Avg CLV |
| --------- | --------------: | ----: | -------------------: | ------------------: | --------------: | --------: | ------: |
| Under 18  |             683 | 91.67 |               103.21 |                1.13 |       70,495.28 |  15,476.8 |   201.0 |
| 18 to 24  |             749 | 88.33 |               101.89 |                1.15 |       76,313.33 |  16,644.2 |   168.1 |
| 25 to 34  |           1,078 | 86.43 |                97.81 |                1.13 |      105,439.74 |  21,245.1 |   171.3 |
| 35 to 44  |           1,047 | 86.53 |                99.42 |                1.15 |      104,096.97 |  25,120.0 |   186.1 |
| 45 to 54  |           1,053 | 91.25 |               103.39 |                1.13 |      108,867.09 |  25,557.5 |   216.6 |
| 55 to 64  |           1,035 | 86.86 |                98.87 |                1.14 |      102,326.21 |  23,486.6 |   180.7 |
| Above 65  |             654 | 87.06 |                96.64 |                1.11 |       63,202.95 |  11,540.9 |   174.9 |


**Sanity Check Result:**  
| Metric | Value |
|---------|--------:|
| Total from Segments | 630,741.57 |
| Total from Base Data | 630,741.57 |
| Difference | 0 (Validated) |

---

## ðŸ”— Insights
- **Ages 45â€“54** show the **highest CLV (avg â‰ˆ 217)** â€” indicating strong repeat purchasing behavior and consistent order values.  
- **Under 18** customers, while smaller in number, exhibit **high individual value (avg CLV â‰ˆ 201)**, likely due to high purchase frequency in short timeframes.  
- **25â€“44** segments remain steady, representing core revenue contributors with balanced order and revenue levels.  
- **Above 65** contributes modestly in total volume but maintains competitive CLV, suggesting retained loyalty among older shoppers.

### ðŸŽ¯ Strategic Takeaways
- Prioritize **45â€“54** for **retention and premium offers** (theyâ€™re your value core).  
- Explore **Under 18** as an **emerging growth cohort**, potentially through youth-targeted campaigns.  
- Maintain **consistent engagement** with **25â€“44** via loyalty programs to sustain mid-tier CLV.

---

**End of Task 3.3** â€” Age-Based CLV Segmentation  
*(Validated and integrated with overall sanity check)*
